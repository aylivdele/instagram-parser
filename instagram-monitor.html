<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Trend Monitor</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            padding-bottom: 80px;
        }

        .header {
            margin-bottom: 24px;
        }

        h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--tg-theme-hint-color, #999);
            font-size: 14px;
        }

        .add-section {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .input-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--tg-theme-text-color, #000);
        }

        input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-hint-color, #ddd);
            border-radius: 8px;
            font-size: 15px;
            background: var(--tg-theme-bg-color, #fff);
            color: var(--tg-theme-text-color, #000);
        }

        input:focus {
            outline: none;
            border-color: var(--tg-theme-button-color, #0088cc);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .btn-primary {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .btn:active {
            opacity: 0.8;
        }

        .competitors-list {
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .competitor-card {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .competitor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .competitor-name {
            font-size: 16px;
            font-weight: 500;
            color: var(--tg-theme-link-color, #0088cc);
        }

        .btn-remove {
            padding: 6px 12px;
            background: #ff3b30;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            font-size: 13px;
        }

        .stat-item {
            color: var(--tg-theme-hint-color, #999);
        }

        .stat-value {
            color: var(--tg-theme-text-color, #000);
            font-weight: 500;
        }

        .alerts-section {
            margin-bottom: 24px;
        }

        .alert-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .alert-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-icon {
            font-size: 24px;
            margin-right: 8px;
        }

        .alert-title {
            font-weight: 600;
            font-size: 15px;
        }

        .alert-subtitle {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .alert-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
            font-size: 13px;
        }

        .alert-link {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--tg-theme-hint-color, #999);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .monitoring-status {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--tg-theme-bg-color, #fff);
            border-top: 1px solid var(--tg-theme-hint-color, #ddd);
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #34c759;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .last-check {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #999);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾ĞºĞ½Ğ° Ğ´Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 12px;
            padding: 20px;
            max-width: 90%;
            width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .modal-message {
            font-size: 15px;
            color: #666;
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }

        .modal-btn-primary {
            background: #0088cc;
            color: white;
        }

        .modal-btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“Š Instagram Monitor</h1>
        <div class="subtitle">ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ²Ğ¸Ñ€ÑƒÑĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ ĞºĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ğ¾Ğ²</div>
    </div>

    <div class="add-section">
        <div class="input-group">
            <label>Username Instagram</label>
            <input type="text" id="usernameInput" placeholder="Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: natgeo" onkeypress="handleEnter(event)">
        </div>
        <button class="btn btn-primary" onclick="addCompetitor()">
            â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ğ°
        </button>
    </div>

    <div class="alerts-section" id="alertsSection">
        <h2 class="section-title">ğŸ”¥ Ğ’Ğ¸Ñ€ÑƒÑĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚</h2>
        <div id="alertsList"></div>
    </div>

    <div class="competitors-list">
        <h2 class="section-title">ğŸ‘¥ ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹</h2>
        <div id="competitorsList"></div>
    </div>

    <div class="monitoring-status">
        <div class="status-indicator">
            <div class="status-dot"></div>
            <span>ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½</span>
        </div>
        <div class="last-check" id="lastCheck">ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ñ‚Ğ¾</div>
    </div>

    <!-- ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ° -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-title" id="modalTitle"></div>
            <div class="modal-message" id="modalMessage"></div>
            <div class="modal-buttons" id="modalButtons"></div>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ: Telegram Mini App Ğ¸Ğ»Ğ¸ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const isTelegramMiniApp = window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initData;
        
        let tg;
        if (isTelegramMiniApp) {
            tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ±Ñ‘Ñ€Ñ‚ĞºĞ¸ Ğ´Ğ»Ñ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showAlert(message) {
            if (isTelegramMiniApp) {
                tg.showAlert(message);
            } else {
                showBrowserModal('Ğ’Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ', message, [
                    { text: 'OK', primary: true, callback: closeModal }
                ]);
            }
        }

        function showPopup(title, message) {
            if (isTelegramMiniApp) {
                tg.showPopup({ title, message });
            } else {
                showBrowserModal(title, message, [
                    { text: 'OK', primary: true, callback: closeModal }
                ]);
            }
        }

        function showConfirm(message, callback) {
            if (isTelegramMiniApp) {
                tg.showConfirm(message, callback);
            } else {
                showBrowserModal('ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ', message, [
                    { text: 'ĞÑ‚Ğ¼ĞµĞ½Ğ°', primary: false, callback: () => { closeModal(); callback(false); } },
                    { text: 'Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ', primary: true, callback: () => { closeModal(); callback(true); } }
                ]);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ´Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function showBrowserModal(title, message, buttons) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            
            const buttonsContainer = document.getElementById('modalButtons');
            buttonsContainer.innerHTML = buttons.map(btn => 
                `<button class="modal-btn ${btn.primary ? 'modal-btn-primary' : 'modal-btn-secondary'}" 
                         onclick="event.stopPropagation(); (${btn.callback.toString()})()">${btn.text}</button>`
            ).join('');
            
            document.getElementById('modalOverlay').classList.add('active');
        }

        function closeModal(event) {
            if (!event || event.target.id === 'modalOverlay') {
                document.getElementById('modalOverlay').classList.remove('active');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ API Ğ¸ Ğ¸Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const API_URL = window.location.origin + '/api';
        
        // ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ user_id
        let USER_ID = null;
        
        if (isTelegramMiniApp && tg.initDataUnsafe && tg.initDataUnsafe.user) {
            // Ğ’ Telegram Mini App Ğ±ĞµÑ€Ñ‘Ğ¼ ID Ğ¸Ğ· Telegram
            USER_ID = `telegram_${tg.initDataUnsafe.user.id}`;
            console.log('User ID Ğ¸Ğ· Telegram:', USER_ID);
        } else {
            // Ğ’ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğ¼ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ localStorage Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾ÑĞ¸Ğ¼ Ğ²Ğ²ĞµÑÑ‚Ğ¸
            USER_ID = localStorage.getItem('instagram_monitor_user_id');
            if (!USER_ID) {
                // Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ ID Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¾Ğ²
                USER_ID = `browser_${Math.random().toString(36).substr(2, 9)}`;
                localStorage.setItem('instagram_monitor_user_id', USER_ID);
            }
            console.log('User ID (Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€):', USER_ID);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let competitors = [];
        let alerts = [];

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // API Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function fetchCompetitors() {
            try {
                const response = await fetch(`${API_URL}/competitors`, {
                    headers: { 'X-User-Id': USER_ID }
                });
                const data = await response.json();
                
                if (data.success) {
                    competitors = data.data;
                    renderCompetitors();
                }
            } catch (error) {
                console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ĞºĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ğ¾Ğ²:', error);
                showAlert('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº ÑĞµÑ€Ğ²ĞµÑ€Ñƒ');
            }
        }

        async function fetchAlerts() {
            try {
                const response = await fetch(`${API_URL}/alerts`, {
                    headers: { 'X-User-Id': USER_ID }
                });
                const data = await response.json();
                
                if (data.success) {
                    alerts = data.data;
                    renderAlerts();
                }
            } catch (error) {
                console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²:', error);
            }
        }

        async function addCompetitor() {
            const username = document.getElementById('usernameInput').value.trim();
            
            if (!username) {
                showAlert('Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ username');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/competitors`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-Id': USER_ID
                    },
                    body: JSON.stringify({ username })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('usernameInput').value = '';
                    await fetchCompetitors();
                    showPopup('âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾', `ĞĞºĞºĞ°ÑƒĞ½Ñ‚ @${username} Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³`);
                } else {
                    showAlert(data.error || 'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ');
                }
            } catch (error) {
                console.error('ĞÑˆĞ¸Ğ±ĞºĞ°:', error);
                showAlert('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº ÑĞµÑ€Ğ²ĞµÑ€Ñƒ');
            }
        }

        async function removeCompetitor(username) {
            showConfirm(`Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ @${username} Ğ¸Ğ· Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°?`, async (confirmed) => {
                if (confirmed) {
                    try {
                        const response = await fetch(`${API_URL}/competitors/${username}`, {
                            method: 'DELETE',
                            headers: { 'X-User-Id': USER_ID }
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            await fetchCompetitors();
                        } else {
                            showAlert(data.error || 'ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ');
                        }
                    } catch (error) {
                        console.error('ĞÑˆĞ¸Ğ±ĞºĞ° ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ:', error);
                        showAlert('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ');
                    }
                }
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ UI
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function renderCompetitors() {
            const list = document.getElementById('competitorsList');
            
            if (competitors.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <div>Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½ĞºÑƒÑ€ĞµĞ½Ñ‚Ğ°</div>
                    </div>
                `;
                return;
            }

            list.innerHTML = competitors.map(c => `
                <div class="competitor-card">
                    <div class="competitor-header">
                        <div class="competitor-name">@${c.username}</div>
                        <button class="btn-remove" onclick="removeCompetitor('${c.username}')">
                            Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ
                        </button>
                    </div>
                    <div class="stats">
                        <div class="stat-item">
                            Ğ¡Ñ€. Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ñ‹: <span class="stat-value">${formatNumber(c.avgViews)}</span>
                        </div>
                        <div class="stat-item">
                            Ğ¡Ñ€. Ğ»Ğ°Ğ¹ĞºĞ¸: <span class="stat-value">${formatNumber(c.avgLikes)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderAlerts() {
            const list = document.getElementById('alertsList');
            
            if (alerts.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ¯</div>
                        <div>ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ Ğ²Ğ¸Ñ€ÑƒÑĞ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°</div>
                    </div>
                `;
                return;
            }

            list.innerHTML = alerts.map(alert => `
                <div class="alert-card">
                    <div class="alert-header">
                        <div class="alert-icon">ğŸš€</div>
                        <div class="alert-title">@${alert.username}</div>
                    </div>
                    <div class="alert-subtitle">
                        Ğ Ğ¾ÑÑ‚: +${alert.growth}% Ğ¾Ñ‚ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğ³Ğ¾
                    </div>
                    <div class="alert-stats">
                        <div>ğŸ“Š ${formatNumber(alert.currentViews)} Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ²</div>
                        <div>â±ï¸ ${getTimeAgo(alert.timestamp)}</div>
                    </div>
                    <a href="${alert.postUrl}" class="alert-link" target="_blank">
                        ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾ÑÑ‚ â†’
                    </a>
                </div>
            `).join('');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ğ£Ñ‚Ğ¸Ğ»Ğ¸Ñ‚Ñ‹
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function getTimeAgo(timestamp) {
            const minutes = Math.floor((Date.now() - new Date(timestamp)) / 60000);
            if (minutes < 60) return `${minutes} Ğ¼Ğ¸Ğ½ Ğ½Ğ°Ğ·Ğ°Ğ´`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours} Ñ‡ Ğ½Ğ°Ğ·Ğ°Ğ´`;
            return `${Math.floor(hours / 24)} Ğ´ Ğ½Ğ°Ğ·Ğ°Ğ´`;
        }

        function updateLastCheck() {
            const now = new Date();
            document.getElementById('lastCheck').textContent = 
                `ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°: ${now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}`;
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                addCompetitor();
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ĞŸĞµÑ€Ğ¸Ğ¾Ğ´Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        setInterval(() => {
            fetchAlerts();
            fetchCompetitors();
            updateLastCheck();
        }, 60000);  // ĞšĞ°Ğ¶Ğ´ÑƒÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function registerUser() {
            // Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµĞ¼/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ·Ğ°Ğ¿ÑƒÑĞºĞµ
            const telegramChatId = isTelegramMiniApp && tg.initDataUnsafe && tg.initDataUnsafe.user 
                ? tg.initDataUnsafe.user.id.toString()
                : null;
            
            try {
                await fetch(`${API_URL}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-Id': USER_ID
                    },
                    body: JSON.stringify({
                        user_id: USER_ID,
                        telegram_chat_id: telegramChatId
                    })
                });
            } catch (error) {
                console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ:', error);
            }
        }
        
        async function init() {
            await registerUser();
            await fetchCompetitors();
            await fetchAlerts();
            updateLastCheck();
        }
        
        init();

        // Telegram Mini App: Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "ĞĞ°Ğ·Ğ°Ğ´"
        if (isTelegramMiniApp) {
            tg.BackButton.onClick(() => {
                tg.close();
            });
        }

        console.log('Instagram Monitor Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ:', isTelegramMiniApp ? 'Telegram Mini App' : 'ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€');
    </script>
</body>
</html>
